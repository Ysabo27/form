<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html lang="he">
<head>
<meta charset="utf-8" />
<title>טופס</title>

<link rel="stylesheet" href="https://cdn.jotfor.ms/stylebuilder/static/form-common.css" />

</head>

<body>

<form class="jotform-form" id="253443389862064">

  <!-- ===== מספר זהות ===== -->
  <div class="form-line" id="id_66">
    <label for="input_66">מספר זהות</label>
    <input
      type="text"
      id="input_66"
      name="q66_input66"
      inputmode="numeric"
      maxlength="9"
      autocomplete="off"
      placeholder="9 ספרות"
    />
  </div>

  <!-- כפתור המשך (של Jotform) -->
  <button
    type="button"
    class="form-submit-button submit-button useJotformSign-button">
    Continue
  </button>

</form>

<!-- ================= אימות ת״ז + חסימה קשיחה ================= -->
<script>
function isValidIsraeliId(value) {
  let str = String(value || "").replace(/\D/g, "");
  if (str.length > 9) return false;
  while (str.length < 9) str = "0" + str;

  let sum = 0;
  for (let i = 0; i < 9; i++) {
    let n = Number(str[i]) * ((i % 2) + 1);
    if (n > 9) n -= 9;
    sum += n;
  }
  return sum % 10 === 0;
}

document.addEventListener("DOMContentLoaded", () => {
  const tz = document.getElementById("input_66");
  const btn = document.querySelector(".useJotformSign-button");

  if (!tz || !btn) return;

  function normalize() {
    tz.value = tz.value.replace(/\D/g, "").slice(0, 9);
  }

  function isValidNow() {
    return tz.value.length === 9 && isValidIsraeliId(tz.value);
  }

  function showError() {
    if (tz.value.length === 0) {
      tz.setCustomValidity("שדה חובה");
    } else if (tz.value.length !== 9) {
      tz.setCustomValidity("יש להזין 9 ספרות");
    } else if (!isValidIsraeliId(tz.value)) {
      tz.setCustomValidity("תעודת זהות לא תקינה");
    } else {
      tz.setCustomValidity("");
    }
    tz.reportValidity();
  }

  function updateButton() {
    const ok = isValidNow();
    btn.disabled = !ok;
    btn.style.opacity = ok ? "1" : "0.5";
    btn.style.cursor = ok ? "pointer" : "not-allowed";
  }

  tz.addEventListener("input", () => {
    normalize();
    if (tz.value.length > 0) showError();
    updateButton();
  });

  tz.addEventListener("blur", () => {
    normalize();
    showError();
    updateButton();
  });

  // חסימה גם אם Jotform מנסה להפעיל בכוח
  btn.addEventListener("click", (e) => {
    if (!isValidNow()) {
      e.preventDefault();
      e.stopImmediatePropagation();
      showError();
      updateButton();
      return false;
    }
  }, true);

  // מצב התחלתי
  updateButton();
});
</script>

</body>
</html>
